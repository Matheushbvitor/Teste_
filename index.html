<!-- index.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MARIANA</title>

  <!-- üîî Alerta de visita (pixel + beacon) -->
  <script>
    (function () {
      var WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwV3aojxYNSgZtKXKA2m1ZBe1hhXP-Ua2-q2ZF4S4fc8D6QunfcbT5HONjA2x2_Tb4/exec";

      function buildParams() {
        var tz = "";
        try { tz = Intl.DateTimeFormat().resolvedOptions().timeZone || ""; } catch {}
        var q = new URLSearchParams({
          url: location.href,
          ref: document.referrer || "",
          ua : navigator.userAgent || "",
          tz : tz,
          origin: "ghpages"
        });
        return q.toString();
      }
      function firePixel() {
        try {
          var img = new Image(1, 1);
          img.referrerPolicy = "no-referrer";
          img.alt = "";
          img.src = WEBAPP_URL + "?" + buildParams();
        } catch {}
      }
      function fireBeacon() {
        try {
          if (!("sendBeacon" in navigator)) return false;
          var tz = "";
          try { tz = Intl.DateTimeFormat().resolvedOptions().timeZone || ""; } catch {}
          var payload = { url: location.href, ref: document.referrer || "", ua: navigator.userAgent || "", tz, origin:"ghpages" };
          var blob = new Blob([JSON.stringify(payload)], { type: "application/json" });
          return navigator.sendBeacon(WEBAPP_URL, blob);
        } catch { return false; }
      }

      firePixel();
      document.addEventListener("visibilitychange", function () {
        if (document.visibilityState === "hidden") fireBeacon();
      });
      window.addEventListener("pagehide", function () { fireBeacon(); });
    })();
  </script>

  <noscript>
    <img src="https://script.google.com/macros/s/AKfycbwV3aojxYNSgZtKXKA2m1ZBe1hhXP-Ua2-q2ZF4S4fc8D6QunfcbT5HONjA2x2_Tb4/exec?origin=noscript"
         alt="" width="1" height="1" referrerpolicy="no-referrer" style="display:none" />
  </noscript>

  <style>
    :root{
      --card-max: 980px;
      --space: clamp(14px, 3.6vw, 24px);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100svh;
      background:#fff;
      background-image:url("IMG_20250823_124847408.jpg");
      background-position:center;
      background-repeat:no-repeat;
      background-size:contain;
      display:grid;
      place-items:center;
      padding: clamp(12px, 3vw, 24px);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
      text-align:center;
    }

    .card{
      position:relative;
      width:min(var(--card-max), 96vw);
      background:rgba(0,0,0,.45);
      color:#fff;
      border-radius: var(--radius);
      backdrop-filter: blur(2px);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      padding: clamp(16px, 4vw, 28px);
    }

    h1.title{
      margin:0 0 10px;
      font-size: clamp(1.8rem, 5.5vw, 3rem);
      line-height:1.15;
      text-shadow:0 1px 2px rgba(0,0,0,.55);
      word-break: break-word;
    }
    .title-emoji{ display:inline-block; transition:opacity .26s ease; }

    .typing{
      margin: 0 auto 14px;
      font-size: clamp(1rem, 3.8vw, 1.35rem);
      line-height: 1.6;
      max-width: min(860px, 92vw);
      border-right:2px solid rgba(255,255,255,.9);
      animation:blink-caret .75s step-end infinite;
      white-space:pre-wrap;
      overflow-wrap:anywhere;
      text-shadow:0 1px 2px rgba(0,0,0,.55);
      text-align:left;
    }
    @keyframes blink-caret{ 50%{ border-color:transparent } }

    .button-container{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content:center;
      margin-top: 10px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: min(100%, 420px);
      min-height:44px;
      padding: .9rem 1.2rem;
      font-size: clamp(1rem, 3.6vw, 1.125rem);
      border:none;
      border-radius:10px;
      cursor:pointer;
      transition: transform .15s ease, filter .15s ease;
    }
    .btn:active{ transform:scale(.98) }
    .btn:hover{ filter:brightness(1.06) }
    .yes{ background:#4CAF50; color:#fff }
    .no { background:#f44336; color:#fff }
    .why{ background:#ff9800; color:#fff; position:relative; overflow:visible }

    .why.attn{ animation: why-pulse 1.4s ease-in-out infinite; box-shadow: 0 0 0 0 rgba(255,152,0,.55); }
    .why.attn::before{
      content:""; position:absolute; inset:-6px; border-radius:12px;
      background: radial-gradient(closest-side, rgba(255,184,77,.45), rgba(255,184,77,0) 70%);
      filter: blur(8px); opacity:.75; pointer-events:none; animation: glow 2.2s ease-in-out infinite;
    }
    .why.attn::after{
      content:"üëà";
      position:absolute; right:-36px; top:50%;
      transform:translateY(-50%) rotate(10deg);
      font-size:22px; text-shadow:0 2px 6px rgba(0,0,0,.35);
      animation: point-left 1s ease-in-out infinite; pointer-events:none;
    }
    @keyframes why-pulse{ 0%{ transform:scale(1); box-shadow:0 0 0 0 rgba(255,152,0,.55) } 70%{ transform:scale(1.04); box-shadow:0 0 0 14px rgba(255,152,0,0) } 100%{ transform:scale(1) } }
    @keyframes glow{ 0%,100%{opacity:.55} 50%{opacity:.85} }
    @keyframes point-left{ 0%,100%{ transform:translateY(-50%) rotate(10deg) } 50%{ transform:translate(-6px,-50%) rotate(-8deg) } }
    .why.wiggle{ animation: wiggle .6s ease }
    @keyframes wiggle{
      0%{ transform:translateY(0) rotate(0) } 25%{ transform:translateY(-1px) rotate(-2deg) }
      50%{ transform:translateY(0) rotate(0) } 75%{ transform:translateY(1px) rotate(2deg) } 100%{ transform:translateY(0) rotate(0) }
    }

    .btn .emo{ margin-left:.35em; display:inline-block; transform:translateY(1px) }

    .dialog-overlay{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); justify-content:center; align-items:center; padding:16px; z-index:50; }
    .dialog-box{ width:min(420px,92vw); background:rgba(255,255,255,.96); border-radius:12px; padding:20px; text-align:center; box-shadow:0 12px 36px rgba(0,0,0,.35); backdrop-filter:blur(2px); }
    .dialog-box p{ margin:0 0 16px; font-size: clamp(1rem, 3.5vw, 1.125rem); color:#333 }
    .dialog-buttons{ display:flex; gap:12px; justify-content:center; }
    .dialog-buttons button{ padding:10px 18px; border:none; border-radius:8px; font-size:1rem; cursor:pointer }

    #acronymFull{
      width:min(860px,92vw);
      margin:16px auto 0;
      padding:12px 16px;
      background:rgba(255,255,255,.06);
      border-radius:12px;
      font-size: clamp(0.95rem, 3.2vw, 1.15rem);
      line-height:1.6;
      transition:height 180ms ease;
      will-change:height;
      overflow:hidden;
      text-align:left;
    }
    #acronymFull .row{ display:flex; align-items:center; gap:10px; margin:2px 0; }
    #acronymFull .letter{
      position:relative; width:28px; height:28px; flex:0 0 28px; border-radius:8px;
      background:rgba(255,255,255,.92); color:#222; font-weight:800; font-size:14px;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 4px 12px rgba(0,0,0,.25); overflow:hidden;
      will-change:transform,filter,opacity;
    }
    #acronymFull .letter.anim{
      animation:pop-in 520ms var(--delay,0ms) cubic-bezier(.2,.7,.2,1) both,
               soft-glow 4s calc(var(--delay,0ms) + 520ms) ease-in-out infinite alternate;
    }
    #acronymFull .letter.anim::after{
      content:""; position:absolute; inset:-30% -140%;
      background:linear-gradient(120deg,transparent 40%,rgba(255,255,255,.85) 50%,transparent 60%);
      transform:translateX(-100%); animation:shine 1.6s calc(var(--delay,0ms) + 260ms) ease-out 1;
      pointer-events:none;
    }
    @keyframes pop-in{0%{transform:scale(.6) translateY(8px) rotate(-8deg);opacity:0;filter:blur(1px)}
      60%{transform:scale(1.05) translateY(-1px);opacity:1;filter:blur(0)}100%{transform:scale(1)}}
    @keyframes soft-glow{from{filter:brightness(1) saturate(1)}to{filter:brightness(1.08) saturate(1.06)}}
    @keyframes shine{to{transform:translateX(100%)}}

    .fx-rise.in{ animation:row-in 420ms var(--d,0ms) cubic-bezier(.2,.8,.2,1) both; }
    .fx-rise.out{ animation:row-out 320ms var(--d,0ms) ease-in both; }
    @keyframes row-in{from{opacity:0;transform:translateY(8px) scale(.98);filter:blur(3px)}
      to{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}}
    @keyframes row-out{from{opacity:1;transform:translateY(0)}
      to{opacity:0;transform:translateY(-6px);filter:blur(3px)}}

    .fx-wipe .text{ will-change:clip-path,transform,opacity; }
    .fx-wipe.in .text{ animation:wipe-in 520ms calc(var(--d,0ms) + 120ms) cubic-bezier(.22,.7,.16,1) both; }
    .fx-wipe.out .text{ animation:row-out 320ms var(--d,0ms) ease-in both; }
    @keyframes wipe-in{from{clip-path:inset(0 100% 0 0);transform:translateY(4px);opacity:0}
      to{clip-path:inset(0 0 0 0);transform:translateY(0);opacity:1}}

    .fx-flip .text{ transform-origin:left center; will-change:transform,opacity; }
    .fx-flip.in  .text{ animation:flip-in 520ms calc(var(--d,0ms) + 90ms) cubic-bezier(.2,.8,.2,1) both; }
    .fx-flip.out .text{ animation:row-out 300ms var(--d,0ms) ease-in both; }
    @keyframes flip-in{from{transform:rotateX(-75deg);opacity:0;filter:blur(2px)}
      to{transform:rotateX(0);opacity:1;filter:blur(0)}}

    @media (prefers-reduced-motion: reduce){
      .why.attn, .why.attn::before, .why.attn::after{ animation:none !important }
    }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1 class="title">Oi Mari <span id="emojiCycler" class="title-emoji" aria-hidden="true">üòç</span></h1>
    <p id="textoDigitado" class="typing" aria-live="polite"></p>

    <div class="button-container">
      <button id="whyBtn" class="btn why attn" aria-label="Descubra por que eu quero uma chance" onclick="abrirPagina()">
        Por que eu quero uma chance? ü§î
      </button>
    </div>

    <div class="button-container">
      <button class="btn yes" onclick="aceitou()">Tenho chance! <span class="emo" role="img" aria-label="rosto apaixonado">ü•∞</span></button>
      <button class="btn no"  onclick="mostrarMensagemNao()">N√£o tenho chance! <span class="emo" role="img" aria-label="triste">üôÅ</span></button>
    </div>

    <section id="acronymFull" aria-live="polite" aria-atomic="true"></section>
  </div>

  <!-- Modal simples -->
  <div class="dialog-overlay" id="dialogo" role="dialog" aria-modal="true" aria-labelledby="dialogMsg">
    <div class="dialog-box">
      <p id="dialogMsg"></p>
      <div class="dialog-buttons">
        <button class="yes" onclick="fecharDialogo()">Fechar</button>
      </div>
    </div>
  </div>

  <!-- √Åudios -->
  <!-- ‚ö†Ô∏è Este √© o fundo da p√°gina index: KENNYG -->
  <audio id="bgm" preload="auto" playsinline>
    <source src="kennyg.mp3" type="audio/mpeg">
  </audio>
  <audio id="feliznavida-audio" preload="auto" playsinline>
    <source src="feliznavida.mp3" type="audio/mpeg">
  </audio>
  <audio id="sadsong-audio" preload="auto" playsinline>
    <source src="sadsong.mp3" type="audio/mpeg">
  </audio>

  <script>
    /* ===== M√∫sica de fundo (kennyg) com atraso de 3s e sem sobreposi√ß√£o ===== */
    const AUTOPLAY_DELAY_MS = 3000;
    let bgmStarted = false;
    let autoplayTimer = null;

    function clearAutoplayTimer(){
      if (autoplayTimer) { clearTimeout(autoplayTimer); autoplayTimer = null; }
    }

    async function startBGM() {
      const a = document.getElementById('bgm');
      if (!a || bgmStarted) return false;
      try { a.volume = 0.6; await a.play(); bgmStarted = true; return true; } catch(e) { return false; }
    }
    function playBGMNow(){
      const a = document.getElementById('bgm');
      if (!a) return;
      clearAutoplayTimer();
      a.volume = 0.6;
      a.play().catch(()=>{});
      bgmStarted = true;
    }
    function pauseBGM(){
      const a = document.getElementById('bgm');
      if (a && !a.paused) a.pause();
      bgmStarted = false;
    }
    function setupAutoplay() {
      clearAutoplayTimer();
      autoplayTimer = setTimeout(startBGM, AUTOPLAY_DELAY_MS);

      document.addEventListener('visibilitychange', ()=>{
        if (document.visibilityState === 'hidden') {
          clearAutoplayTimer();
          pauseBGM();
        } else if (!bgmStarted) {
          startBGM();
        }
      });
      window.addEventListener('pageshow', ()=>{ if (!bgmStarted) startBGM(); });
      window.addEventListener('beforeunload', clearAutoplayTimer);
      requestAnimationFrame(()=>{}); // noop para manter gesture chain
    }

    /* ===== SadSong no modal ===== */
    function playSadLoop(){
      const sad = document.getElementById('sadsong-audio');
      if (!sad) return;
      pauseBGM();
      sad.loop = true; sad.volume = 0.5;
      try { sad.currentTime = 0; sad.play().catch(()=>{}); } catch(e){}
    }
    function stopSadLoop(){
      const sad = document.getElementById('sadsong-audio');
      if (!sad) return;
      try { sad.pause(); } catch(e){}
      sad.currentTime = 0; sad.loop = false;
    }

    async function playFromElementOrNew(id, src, volume=0.5){
      const el=document.getElementById(id);
      const tryP=async a=>{try{a.volume=volume;a.currentTime=0;await a.play();return true}catch{return false}};
      if(el){
        pauseBGM();
        stopSadLoop();
        if (await tryP(el)) return true;
      }
      const dyn=new Audio(src); dyn.preload='auto'; dyn.volume=volume;
      pauseBGM(); stopSadLoop();
      return await tryP(dyn);
    }

    async function aceitou(){
      await playFromElementOrNew('feliznavida-audio','feliznavida.mp3',0.5);
      const msg = encodeURIComponent(`üíö V√≠nculo seguro em forma√ß√£o. Risco de apego saud√°vel confirmado.
Indica√ß√£o: se voc√™ sentir vontade, podemos marcar algo ‚Äî uma boa conversa‚Ä¶ ou simplesmente estar perto, do jeito mais leve poss√≠vel.`);
      setTimeout(()=>{ window.location.href=`https://wa.me/5518996259121?text=${msg}`; },4500);
    }

    function abrirPagina(){
      clearAutoplayTimer();
      pauseBGM();
      stopSadLoop();
      window.location.href="pagina.html";
    }

    function mostrarMensagemNao(){
      playSadLoop();
      const overlay = document.getElementById('dialogo');
      const boxText = document.getElementById('dialogMsg');
      boxText.textContent = 'Espero que tenha soado leve, respeitoso e com carinho. Estarei dispon√≠vel, no seu tempo ‚Äî quando (e se) voc√™ quiser.';
      overlay.style.display = 'flex';
    }
    function fecharDialogo(){
      document.getElementById('dialogo').style.display='none';
      stopSadLoop();
      playBGMNow();
    }

    /* ===== Texto digitando (cabe√ßalho) ===== */
    const texto =
`Acho que t√¥ precisando de terapia‚Ä¶ ando com uns sintomas meio suspeitos: cora√ß√£o acelerado, sorriso bobo e uma vontade de te ver todo dia.
Sinceramente? T√¥ come√ßando a desconfiar que o diagn√≥stico √© voc√™.
Com todo respeito, √© claro‚Ä¶ mas ser√° que eu teria alguma chance com voc√™?`;
    const destino=document.getElementById("textoDigitado"); let index=0;
    const BASE_INTERVAL=18, COMMA_PAUSE=27, SENTENCE_PAUSE=56, REVEAL_DELAY=133, FADE_DURATION=40;
    function nextDelayFor(c){ if(c===','||c===';') return BASE_INTERVAL+COMMA_PAUSE; if('.!?‚Ä¶'.includes(c)) return BASE_INTERVAL+SENTENCE_PAUSE; return BASE_INTERVAL; }
    function digitarSequencial(){
      if(index>=texto.length){ destino.style.borderRight='none'; return; }
      const c=texto.charAt(index);
      if(c===' '){ destino.append(' '); index++; return setTimeout(digitarSequencial,BASE_INTERVAL); }
      if(c==='\n'){ destino.appendChild(document.createElement('br')); index++; return setTimeout(digitarSequencial,BASE_INTERVAL+SENTENCE_PAUSE); }
      const span=document.createElement('span'); span.textContent='‚ù§Ô∏è'; span.style.display='inline'; span.style.opacity='1';
      span.style.transition=`opacity ${FADE_DURATION}ms ease`; destino.appendChild(span);
      setTimeout(()=>{ span.style.opacity='0'; setTimeout(()=>{ span.textContent=c; span.style.opacity='1'; index++; setTimeout(digitarSequencial,nextDelayFor(c)); },FADE_DURATION); },REVEAL_DELAY);
    }

    const emojiList=["ü§©","ü•∞","üòç","üíñ"], emojiEl=document.getElementById("emojiCycler"); let emojiIndex=0;
    function cycleEmoji(){ emojiEl.style.opacity='0'; setTimeout(()=>{ emojiIndex=(emojiIndex+1)%emojiList.length; emojiEl.textContent=emojiList[emojiIndex]; emojiEl.style.opacity='1'; },260); }

    /* ===== Acr√¥nimos ===== (mantidos) */
    const ACRONYM_BLOCK = `---ACRONIMOS_POR_LETRA---
[M]
- Meu motivo de sorrir
- Minha palmeirense preferida
- Melodia suave da vida
- Minha camisa 10
- Modelo √∫nico
- Motivada e focada
- Meu melhor lugar no mundo
- Meu mundo fica melhor com voc√™
- Meu sorriso preferido mora em voc√™
- Minha dose di√°ria de dopamina
- Maravilhosa

[A]
- Amor em cada gesto
- A √∫nica terapia que eu quero √© estar ao seu lado
- An√°lise nenhuma explica o que sinto por voc√™
- Alegria que contagia
- A √∫nica que quero ao meu lado
- Adora dar bronca (rs)
- Apaixonante
- Atrapalha meu cora√ß√£o (faz ele errar as batidas rs)
- Alma linda que encanta
- Aut√™ntica em cada gesto
- Amo seus surtinhos (fofos)
- Abrigo contra qualquer tempestade
- Amiga
- Admir√°vel
- Amo
- A refer√™ncia que eu admiro
- Amanhecer mais bonito ao seu lado
- Amor que nenhum teste de Rorschach disfar√ßa

[R]
- Raz√£o das minhas melhores inspira√ß√µes
- Refer√™ncia nos meus sonhos (at√© o Jung concordaria)
- Risada fofa
- Rara e preciosa
- Respons√°vel e brilhante
- Respiro aliviado quando te vejo
- Romance que eu quero viver
- Rosto que ilumina meus dias

[I]
- Ilumina qualquer ambiente
- Insight mais lindo da minha vida
- Incrivelmente gente boa
- Irrepreens√≠vel no car√°ter
- Imposs√≠vel n√£o te notar
- Incompar√°vel na ess√™ncia
- Intelig√™ncia que encanta
- Imensa no cora√ß√£o
- Inesquec√≠vel

[N]
- Ningu√©m se compara a voc√™
- Nem Freud explica minha atra√ß√£o por voc√™
- Nunca perde o charme
- Na medida exata do meu sonho
- Not√°vel por onde passa
- Nocaute no meu cora√ß√£o
- N√≠vel m√°ximo de encanto
- Nunca te trocaria por nada
- Nos meus planos, sempre voc√™
---FIM---`;
    function parseGroup(block, letter){
      const re=new RegExp(`\\[${letter}\\]([\\s\\S]*?)(?=\\n\\[|---FIM---)`,'m');
      const m=block.match(re); if(!m) return [];
      return m[1].split('\n').map(l=>l.replace(/^\s*-\s*/,'').trim()).filter(Boolean);
    }
    const GROUPS={ M:parseGroup(ACRONYM_BLOCK,'M'), A:parseGroup(ACRONYM_BLOCK,'A'), R:parseGroup(ACRONYM_BLOCK,'R'), I:parseGroup(ACRONYM_BLOCK,'I'), N:parseGroup(ACRONYM_BLOCK,'N') };
    function pickOne(arr,avoid){ const pool=arr.filter(x=>x!==avoid); return pool.length?pool[Math.floor(Math.random()*pool.length)]:(arr[0]||''); }
    function pickDistinctA(aArr,used,avoid){ const pool=aArr.filter(x=>!used.has(x)&&x!==avoid); if(!pool.length){ const fb=aArr.filter(x=>x!==avoid); return fb.length?fb[Math.floor(Math.random()*fb.length)]:(aArr[0]||''); } return pool[Math.floor(Math.random()*pool.length)]; }
    function makeAcronymSets(count=20){
      const sets=[], lastByPos=Array(7).fill(null);
      for(let s=0;s<count;s++){
        const usedA=new Set();
        const l0=pickOne(GROUPS.M,lastByPos[0]);
        const l1=pickDistinctA(GROUPS.A,usedA,lastByPos[1]); usedA.add(l1);
        const l2=pickOne(GROUPS.R,lastByPos[2]);
        const l3=pickOne(GROUPS.I,lastByPos[3]);
        const l4=pickDistinctA(GROUPS.A,usedA,lastByPos[4]); usedA.add(l4);
        const l5=pickOne(GROUPS.N,lastByPos[5]);
        const l6=pickDistinctA(GROUPS.A,usedA,lastByPos[6]);
        const set=[l0,l1,l2,l3,l4,l5,l6];
        for(let i=0;i<7;i++) lastByPos[i]=set[i];
        sets.push(set);
      }
      return sets;
    }

    let ACRONYM_SETS=[], currentSet=0, swapBusy=false;
    const FX_TYPES=['rise','wipe','flip'];

    function buildWrapper(lines){
      const letters=['M','A','R','I','A','N','A'];
      const wrapper=document.createElement('div');
      lines.forEach((txt,i)=>{
        const row=document.createElement('div');
        const fx=FX_TYPES[Math.floor(Math.random()*FX_TYPES.length)];
        row.className=`row fx-${fx} in`; row.dataset.fx=fx; row.style.setProperty('--d',`${i*70}ms`);
        const chip=document.createElement('div'); chip.className='letter anim'; chip.style.setProperty('--delay',`${i*80}ms`); chip.textContent=letters[i]||'';
        const span=document.createElement('div'); span.className='text'; span.textContent=txt;
        row.appendChild(chip); row.appendChild(span); wrapper.appendChild(row);
      });
      return wrapper;
    }

    function renderFullAcronym(lines){
      const full=document.getElementById('acronymFull'); if(!full) return;
      const wrapper=buildWrapper(lines);

      const meas=full.cloneNode(false);
      meas.style.cssText='position:absolute; visibility:hidden; pointer-events:none; left:-9999px; top:0; height:auto;';
      meas.style.width=full.clientWidth+'px';
      meas.appendChild(wrapper.cloneNode(true));
      full.parentNode.appendChild(meas);
      const newH=meas.scrollHeight; meas.remove();

      const currentH=full.offsetHeight || 0;
      const targetH=Math.max(currentH, newH);
      full.style.height=targetH+'px';

      full.innerHTML='';
      full.appendChild(wrapper);

      requestAnimationFrame(()=>{ full.style.height=newH+'px'; });
      const onEnd=e=>{ if(e.propertyName==='height'){ full.style.height='auto'; full.removeEventListener('transitionend',onEnd); } };
      full.addEventListener('transitionend',onEnd);
    }

    function swapAcronym(lines){
      if(swapBusy) return; swapBusy=false;
      const full=document.getElementById('acronymFull');
      const rows=[...full.querySelectorAll('.row')];

      if(!rows.length){ renderFullAcronym(lines); swapBusy=false; return; }
      rows.forEach((r,i)=>{ r.classList.remove('in'); r.classList.add('out'); r.style.setProperty('--d',`${i*70}ms`); });
      const outTotal = 320 + (rows.length - 1) * 70 + 60;

      setTimeout(()=>{ renderFullAcronym(lines); swapBusy=false; }, outTotal);
    }
    function nextAcronym(){ currentSet=(currentSet+1)%ACRONYM_SETS.length; swapAcronym(ACRONYM_SETS[currentSet]); }

    const CYCLE_MS = 5000;
    window.addEventListener('load', ()=>{
      const why = document.getElementById('whyBtn');
      setInterval(()=>{ if(why) { why.classList.add('wiggle'); setTimeout(()=>why.classList.remove('wiggle'), 600); } }, 5200);

      digitarSequencial();
      setInterval(cycleEmoji, 5000);

      ACRONYM_SETS=makeAcronymSets(20);
      renderFullAcronym(ACRONYM_SETS[0]);

      let timer=setInterval(nextAcronym, CYCLE_MS);
      document.addEventListener('visibilitychange', ()=>{
        if(document.visibilityState==='visible'){ clearInterval(timer); timer=setInterval(nextAcronym, CYCLE_MS); }
        else { clearInterval(timer); }
      });

      setupAutoplay();
    });
  </script>
</body>
</html>
